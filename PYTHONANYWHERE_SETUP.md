# Safe Let Stays - PythonAnywhere Deployment

## Files Created for Deployment

| File | Purpose |
|------|---------|
| `settings_production.py` | Production Django settings (DEBUG=False, security settings) |
| `wsgi_pythonanywhere.py` | WSGI config to paste into PythonAnywhere |
| `requirements.txt` | Python package list for installation |

---

## FIRST TIME SETUP

Run this **once** to set up the project for the first time on PythonAnywhere:

```bash
#!/bin/bash
# === SAFE LET STAYS - FIRST TIME SETUP ===
# Run this ONCE on PythonAnywhere to set up the project

cd ~

# Remove old empty folder if it exists
if [ -d "safeletstays" ]; then
    echo "ðŸ—‘ï¸ Removing old safeletstays folder..."
    rm -rf safeletstays
fi

echo "ðŸ“¥ Cloning repository from GitHub..."
git clone https://github.com/DanielPicciau/Safe-Let-Stays.git safeletstays

cd safeletstays

echo "ðŸ Creating virtual environment..."
python3 -m venv .venv
source .venv/bin/activate

echo "ðŸ“š Installing dependencies..."
pip install --upgrade pip wheel
pip install django pillow

echo "ðŸ“ Creating logs directory..."
mkdir -p logs
touch logs/django_error.log

echo "ðŸ§¾ Running migrations..."
python manage.py migrate --settings=safeletstays.settings_production

echo "ðŸŽ¨ Collecting static files..."
python manage.py collectstatic --noinput --settings=safeletstays.settings_production

echo "ðŸ¤– Creating robots.txt..."
mkdir -p staticfiles
cat > staticfiles/robots.txt <<EOF
User-agent: *
Allow: /

Sitemap: https://SLPM-WebFlareUK.pythonanywhere.com/sitemap.xml
EOF

echo "ðŸ”‘ Generating secret key (COPY THIS FOR WSGI FILE)..."
echo "========================================"
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
echo "========================================"

echo ""
echo "âœ… FIRST TIME SETUP COMPLETE!"
echo ""
echo "Now go to Web tab and configure:"
echo "  Source code: /home/WebFlareUK/safeletstays"
echo "  Working directory: /home/WebFlareUK/safeletstays"
echo "  Virtualenv: /home/WebFlareUK/safeletstays/.venv"
echo ""
echo "Static files:"
echo "  /static/ -> /home/WebFlareUK/safeletstays/staticfiles"
echo "  /media/  -> /home/WebFlareUK/safeletstays/media"
echo ""
echo "Then edit WSGI file and paste the secret key above!"
```

---

## Web Tab Configuration

In the PythonAnywhere Web tab, set:

| Setting | Value |
|---------|-------|
| Source code | `/home/WebFlareUK/safeletstays` |
| Working directory | `/home/WebFlareUK/safeletstays` |
| Virtualenv | `/home/WebFlareUK/safeletstays/.venv` |

---

## Static Files Configuration

In the Static Files section of the Web tab:

| URL | Directory |
|-----|-----------|
| `/static/` | `/home/WebFlareUK/safeletstays/staticfiles` |
| `/media/` | `/home/WebFlareUK/safeletstays/media` |

---

## WSGI File Configuration

1. Click on the WSGI configuration file link in the Web tab
2. Delete all existing content
3. Paste this code:

```python
import os
import sys

# Add your project directory to the sys.path
project_home = '/home/WebFlareUK/safeletstays'
if project_home not in sys.path:
    sys.path.insert(0, project_home)

# Set environment variables
os.environ['DJANGO_SETTINGS_MODULE'] = 'safeletstays.settings_production'
os.environ['DJANGO_SECRET_KEY'] = 'paste-your-secret-key-here'  # <-- PASTE YOUR KEY FROM SETUP

from django.core.wsgi import get_wsgi_application
application = get_wsgi_application()
```

4. Paste the secret key generated by the first-time setup script
5. Save the file
6. Click **Reload** at the top of the Web tab!

---

## Quick Reference

```
PythonAnywhere Username: WebFlareUK
Domain: SLPM-WebFlareUK.pythonanywhere.com
Project Path: /home/WebFlareUK/safeletstays
Virtualenv Path: /home/WebFlareUK/safeletstays/.venv
WSGI File: /var/www/SLPM-WebFlareUK_pythonanywhere_com_wsgi.py
```

---

## Troubleshooting

### Check Error Log
If something goes wrong, check the error log in the Web tab.

### Common Issues

**"Module not found" errors:**
- Verify virtualenv path is correct
- Ensure all packages are installed in the virtualenv

**500 Internal Server Error:**
- Check the error log
- Verify WSGI file has correct paths

**Static files not loading:**
- Verify static file mappings in Web tab
- Run `python manage.py collectstatic --settings=safeletstays.settings_production`

**"DisallowedHost" error:**
- Add your domain to `ALLOWED_HOSTS` in `settings_production.py`
- Reload the web app

---

## Deployment Script

After initial setup, use this script to deploy updates. Save it as `deploy.sh` or paste directly into PythonAnywhere Bash console:

```bash
#!/bin/bash
# === SAFE LET STAYS DEPLOYMENT SCRIPT ===
# Paste/run this on PythonAnywhere after a git push

cd /home/WebFlareUK/safeletstays

# Activate virtual environment
source .venv/bin/activate

echo "ðŸ“¦ Resetting local changes and pulling latest from GitHub..."
git reset --hard HEAD
git pull origin main

echo "ðŸ“š Installing/updating dependencies..."
pip install --upgrade pip wheel
pip install -r requirements.txt

echo "ðŸ§¾ Making migrations..."
python manage.py makemigrations --settings=safeletstays.settings_production
python manage.py migrate --settings=safeletstays.settings_production

echo "ðŸŽ¨ Collecting static files..."
python manage.py collectstatic --noinput --settings=safeletstays.settings_production

echo "ðŸ¤– Creating/updating robots.txt..."
mkdir -p staticfiles
cat > staticfiles/robots.txt <<EOF
User-agent: *
Allow: /

Sitemap: https://SLPM-WebFlareUK.pythonanywhere.com/sitemap.xml
EOF

echo "ðŸ§¹ Clearing expired sessions..."
python manage.py clearsessions --settings=safeletstays.settings_production || true

echo "ðŸš€ Deployment complete!"
echo "âœ… Go to the PythonAnywhere Web tab and click Reload to apply changes."
```
